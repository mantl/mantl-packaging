---
name: mantl-collectd
version: 1.0.0
license: ASL 2.0
iteration: 1
vendor: Asteris
url: https://github.com/asteris-llc/mantl-packaging
description: Collectd integration with Mantl
type: rpm

depends:
  - collectd
  - libsemanage-python

targets:
  - src: "{{.SpecRoot}}/collectd.conf"
    dest: /etc/collectd.conf
    config: true

# delete Hostname setting so that the hostname will be determined using the gethostname(2) system call
# mkdir -p /usr/share/collectd/plugins && chmod 0755 /usr/share/collectd/plugins
scripts:
  before-install: |
    mkdir -p /usr/share/collectd/plugins && chmod 0755 /usr/share/collectd/plugins
    sed -i '' "/collectd/a Hostname \"$(cat /etc/meta/id || hostname)\"" /etc/collectd.conf

# authorize collectd to make tcp connections
    # start collectd on boot
  after-install: |
    setsebool -P collectd_tcp_network_connect 1
    systemctl enable collectd 2>/dev/null
