---
name: vaultfs
version: 1.0.0
license: ASL 2.0
iteration: 1
vendor: Asteris
url: https://github.com/asteris-llc/vaultfs
architecture: x86_64
description: Vault filesystem (and Docker volume plugin)
type: rpm

depends:
  - systemd

resources:
  - url: https://github.com/asteris-llc/vaultfs/releases/download/{{.Version}}/vaultfs-{{.Version}}-linux-amd64.tar.gz
    hash-type: sha256
    hash: 4c7d8bc9702cfa2b315235343043ec2df18e42814cf7d8f38aa69b0a945c9bcf

targets:
  - src: "{{.BuildRoot}}/vaultfs"
    dest: /usr/bin/vaultfs
  - src: "{{.SpecRoot}}/vaultfs-docker.service"
    dest: /etc/systemd/system/vaultfs-docker.service
    template: true
  - src: "{{.SpecRoot}}/vaultfs.sysconfig"
    dest: /etc/sysconfig/vaultfs
    config: true
  - src: "{{.SpecRoot}}/vaultfs.service"
    dest: /etc/systemd/system/vaultfs.service
    template: true
  - src: "{{empty}}"
    dest: /var/lib/vaultfs-docker
  - src: "{{empty}}"
    dest: /var/lib/vaultfs

scripts:
  build: |
    tar -xzvf vaultfs-{{.Version}}-linux-amd64.tar.gz
    cp vaultfs-{{.Version}}-linux-amd64/vaultfs vaultfs

  after-install: |
    systemctl daemon-reload

  before-remove: |
    systemctl disable vaultfs.service
    systemctl disable vaultfs-docker.service

extra-args: |
  --rpm-os linux
  --rpm-auto-add-directories
  --rpm-auto-add-exclude-directories /etc/systemd
  --rpm-auto-add-exclude-directories /etc/systemd/system
